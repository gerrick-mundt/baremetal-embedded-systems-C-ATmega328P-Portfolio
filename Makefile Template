#--------------------------------------------------
# MCU and clock settings
#--------------------------------------------------
MCU = atmega328p
F_CPU = 16000000UL

#--------------------------------------------------
# Source files
#--------------------------------------------------
SRC = /Users/gerrickmundt/Documents/Baremetal_Code/Project5_ATmega328P_InterruptLED/main.c \
      /Users/gerrickmundt/Documents/Baremetal_Code/ATmega328P_portWrite.c

#--------------------------------------------------
# Include paths
#--------------------------------------------------
INC = -I/Users/gerrickmundt/Documents/Baremetal_Code

#--------------------------------------------------
# Output file names
#--------------------------------------------------
TARGET = main
ELF = $(TARGET).elf
HEX = $(TARGET).hex

#--------------------------------------------------
# Compiler and flags
#--------------------------------------------------
CC = avr-gcc
CFLAGS = -mmcu=$(MCU) -DF_CPU=$(F_CPU) $(INC) -Wall

#--------------------------------------------------
# Tools
#--------------------------------------------------
OBJCOPY = avr-objcopy
AVRDUDE = avrdude

#--------------------------------------------------
# Default target: build ELF and HEX
#--------------------------------------------------
all: $(HEX)

# Build ELF
$(ELF): $(SRC)
	$(CC) $(CFLAGS) -o $(ELF) $(SRC)

# Convert ELF to HEX
$(HEX): $(ELF)
	$(OBJCOPY) -O ihex -R .eeprom $(ELF) $(HEX)

#--------------------------------------------------
# Flash target
#--------------------------------------------------
flash: $(HEX)
	$(AVRDUDE) -c arduino -p $(MCU) -P /dev/tty.usbmodem1101 -b 115200 -U flash:w:$(HEX)

#--------------------------------------------------
# Clean target
#--------------------------------------------------
clean:
	rm -f $(ELF) $(HEX)
